# --
# AgentITSMConfigItemSearch.dtl - provides HTML form for AgentITSMConfigItemSearch
# Copyright (C) 2001-2010 OTRS AG, http://otrs.org/
# --
# $Id: AgentITSMConfigItemSearch.dtl,v 1.22 2010/12/18 01:47:06 cr Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

<!-- dtl:block:Result -->
<div id="ContextSettingsDialogContainer" class="Hidden">
    <form action="$Env{"CGIHandle"}" method="post" id="ContextSettingsDialog">
        <input type="hidden" name="Action" value="AgentPreferences"/>
        <input type="hidden" name="Subaction" value="Update"/>
        <input type="hidden" name="Group" value="$QData{"Group"}"/>
        <input type="hidden" name="RedirectURL" value="$QData{"RequestedURL"}"/>
        <fieldset class="TableLike">
            <label for="$QData{"PreferencesKey"}">$Text{"Max. shown Configuration Itms per page"}:</label>
            <div class="Field">
                $Data{"PageShownString"}
            </div>
            <div class="Clear"></div>
        </fieldset>
    </form>
</div>
<div class="OverviewBox ARIARoleMain Small">
    <h1>$Text{"Search Result for Class $Data{"Class"}:"} </h1>
    <div id="OverviewControl" class="OverviewControl">
        <div>
            <div class="ControlRow">
                <ul class="Tabs">
                    <li>
                        <a id='ITSMConfigItemSearch' href="$Env{"Baselink"}Action=$Env{"Action"};Profile=$LQData{"Profile"};ClassID=$LQData{"ClassID"}">
                            $Text{"Change search options"}
                        </a>
                    </li>
                </ul>
                <ul class="ContextFunctions">
                    <li class="ContextSettings">
                        <a href="#" id="ShowContextSettingsDialog" title="$Text{"Context Settings"}"><span>$Text{"Context Settings"}</span></a>
                    </li>
                </ul>
<!--dtl:js_on_document_complete-->
<script type="text/javascript">//<![CDATA[
    $('#ITSMConfigItemSearch').bind('click', function (Event) {
        ITSM.Agent.ConfigItem.Search.OpenSearchDialog( 'AgentITSMConfigItemSearch', '$QData{"Profile"}', '$QData{"ClassID"}' );
        return false;
    });
//]]></script>
<!--dtl:js_on_document_complete-->
            </div>
            <div class="ActionRow">
                <div class="OverviewActions">
                    <ul class="OverviewZoom">
                        <li class="Active Last">
                            <a title="Small" href="$Env{"Baselink"}Action=AgentITSMConfigItemSearch;Filter=;View=Small;TakeLastSearch=1;Subaction=Search;Profile=$LQData{"Profile"};ClassID=$LQData{"ClassID"};" class="Small">
                                <span class="ImageMode">
                                    <span class="NameShort">S</span>
                                    <span class="NameLong">Small</span>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <span class="Pagination">
<!-- dtl:block:OverviewNavBarPageNavBar -->
                        $Data{"ResultLong"}
                        $Data{"SiteNavBarLong"}
<!-- dtl:block:OverviewNavBarPageNavBar -->
                    </span>
                    <div class="ClearLeft"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="Overview FixedHeader" id="OverviewBody">
        <table class="TableSmall" id="FixedTable">
            <thead class="ITSMHeader">
                <tr>
<!-- dtl:block:ResultHeader -->
                    <th class="Flags">
                        <span>$Text{"Incident State"}</span>
                    </th>
                    <th>
                        <span>$Text{"Number"}</span>
                    </th>
                    <th>
                        <span>$Text{"Name"}</span>
                    </th>
                    <th>
                        <span>$Text{"Deployment State"}</span>
                    </th>
                    <th>
                        <span>$Text{"Last Change"}</span>
                    </th>
<!-- dtl:block:ResultHeader -->
                </tr>
            </thead>
            <tbody>
<!-- dtl:block:ResultRow -->
                <tr>
                    <td title="$QData{"CurInciState"}">
                        <div class="Flag Small">
                            <span class="$QData{"CurInciSignal"}">"$QData{"InciState"}"</span>
                        </div>
                    </td>
                    <td>
                        <a href="$Env{"Baselink"}Action=AgentITSMConfigItemZoom;ConfigItemID=$LQData{"ConfigItemID"}">$LQData{"Number"}</a>
                    </td>
                    <td>
                        $QData{"Name","40"}
                    </td>
                    <td>
                        $Text{"$Data{"CurDeplState"}"}
                    </td>
                    <td>
                        $TimeLong{"$QData{"CreateTime"}"}
                    </td>
                </tr>
<!-- dtl:block:ResultRow -->
<!-- dtl:block:ResultRowEmpty -->
                <tr>
                    <td colspan="5">
                        $Text{"No results found."}
                    </td>
                </tr>
<!-- dtl:block:ResultRowEmpty -->
            </tbody>
        </table>
    </div>
</div>

<!-- dtl:js_on_document_complete -->
<script type="text/javascript">//<![CDATA[
    Core.UI.InitTableHead($('#FixedTable thead'), $('#FixedTable tbody'));
    Core.UI.StaticTableControl($('#OverviewControl').add($('#OverviewBody')));
    $('.MasterAction').bind('click', function (Event) {
        window.location = $(this).find('.MasterActionLink').attr('href');
    });
    $(window).resize(function() {
        Core.UI.AdjustTableHead($('#OverviewHeader thead'), $('#OverviewBody tbody'));
    });

    // bind the ContextSettingsDialogContainer
    $('#ShowContextSettingsDialog').bind('click', function (Event) {
        Core.UI.Dialog.ShowContentDialog($('#ContextSettingsDialogContainer'), '$JSText{"Settings"}', '20%', 'Center', true,
            [
                {
                    Label: '$JSText{"Submit"}',
                    Type: 'Submit',
                    Class: 'Primary'
                }
            ]
        );
        Event.preventDefault();
        Event.stopPropagation();
        return false;
    });
//]]></script>
<!-- dtl:js_on_document_complete -->
<!-- dtl:block:Result -->

<!-- dtl:block:SearchAJAX -->
<div class="InnerContent">
    <fieldset class="TableLike">
        <div class="Clear"></div>
        <label for="Class">$Text{"Class"}</label>
        <div class="Field" id='DivClassID'>
            $Data{"ClassOptionStrg"}
        </div>
    </fieldset>
</div>

<div class="InnerContent" id="AJAXUpdate">

    <form action="$Env{"CGIHandle"}" method="post" id="SearchForm">
        <input type="hidden" name="Action" value="$Env{"Action"}"/>
        <input type="hidden" name="Subaction" value="Search"/>

        <fieldset class="TableLike Hidden" id='ITSMSearchProfile'>
            <div class="Clear"></div>
            <label>$Text{"Search-Template"}</label>
            <div class="Field">
                <input type="hidden" id="SearchProfile" name="SearchProfile" value="$QData{"Profile"}"/>

                <button id="SearchProfileNew" value="$Text{"Create New"}">$Text{"Create New"}</button>

                <button id="SearchProfileDelete" class="Hidden" value="$Text{"Delete"}">$Text{"Delete"}</button>

                <div id="SearchProfileAddBlock">
                    <input type="text" name="ProfileName" id="SearchProfileAddName"/>
                    <button type="submit" title="$Text{"Create Template"}" id="SearchProfileAddAction">$Text{"Create New Template"}</button>
                    <input type="hidden" name="SaveProfile" value="1"/>
                </div>
            </div>
        </fieldset>

    </form>
</div>

<div class="ContentFooter Center">
    <button id="SearchFormSubmit" class="Primary Hidden" value="Run Search">$Text{"Run Search"}</button>
</div>
<script type="text/javascript">//<![CDATA[
/*global ITSM: true */
    window.setTimeout(function (){
        $('#SearchClassID').bind('change', function(){
            if ( $('#SearchClassID').val() !== "" ){
                ITSM.Agent.ConfigItem.Search.LoadProfile( $('#SearchProfile').val() );
            }
            else {
                $('#SearchProfile').attr("id", "SearchProfileOld");
            }
        });
    }, 150);
//]]></script>
<!-- dtl:block:SearchAJAX -->

$Include{"AgentITSMCustomerSearch"}

<!-- dtl:block:SearchAJAXSetClass -->
<script type="text/javascript">//<![CDATA[
/*global ITSM: true */
    window.setTimeout(function (){
            ITSM.Agent.ConfigItem.Search.LoadProfile( "$QData{"Profile"}" );
    }, 150);
//]]></script>
<!-- dtl:block:SearchAJAXSetClass -->

<!-- dtl:block:Search -->
<!--dtl:js_on_document_complete-->
<script type="text/javascript">//<![CDATA[
/*global ITSM: true */
    ITSM.Agent.ConfigItem.Search.OpenSearchDialog( '$Env{"Action"}', "$QData{"Profile"}", "$QData{"ClassID"}" );
//]]></script>
<!--dtl:js_on_document_complete-->
<!-- dtl:block:Search -->


<!-- dtl:block:AJAXContent -->
<form action="$Env{"CGIHandle"}" method="post" id="SearchForm">
    <input type="hidden" name="Action" value="$Env{"Action"}"/>
    <input type="hidden" name="Subaction" value="Search"/>
    <input type="hidden" name="ClassID" value="$QData{"ClassID"}">
    <input type="hidden" name="SearchDialog" value='1'>
    <input type="hidden" name="EmptySearch" value="$QData{"EmptySearch"}" id="EmptySearch"/>
    <fieldset class="TableLike Hidden" id='ITSMSearchProfile'>
        <div class="Clear"></div>
        <label>$Text{"Search template"}:</label>
        <div class="Field">
            $Data{"ProfilesStrg"}

            <button id="SearchProfileNew" value="$Text{"Create New"}">$Text{"Create New"}</button>

            <button id="SearchProfileDelete" class="Hidden" value="$Text{"Delete"}">$Text{"Delete"}</button>

            <div id="SearchProfileAddBlock">
                <input type="text" name="ProfileName" id="SearchProfileAddName"/>
                <button type="submit" title="$Text{"Create Template"}" id="SearchProfileAddAction">$Text{"Create New Template"}</button>
            </div>
        </div>
        <div class="Clear"></div>
        <label>$Text{"Save changes in template"}:</label>
        <div class="Field">
            <input type="checkbox" name="SaveProfile" id="SaveProfile" value="1"/>
        </div>

    </fieldset>

    <fieldset class="TableLike Hidden" id='ITSMSearchFields'>
        <fieldset class="TableLike" id="SearchInsert"></fieldset>
        <div class="Clear"></div>
        <label>$Text{"Add another attribute"}:</label>
        <div class="Field">
            $Data{"AttributesStrg"}
            <button type="submit" class="Add" value="Add" title="Add entry">$Text{"Add"}</button>
        </div>

        <div class="Clear"></div>
        <label for="PreviousVersionSearch">$Text{"Also search in previous versions?"}</label>
        <div class="Field">
            $Data{"PreviousVersionOptionStrg"}
        </div>

        <div class="Clear"></div>
        <label>$Text{"Output"}:</label>
        <div class="Field">
            $Data{"ResultFormStrg"}
        </div>
    </fieldset>
</form>
<fieldset class="TableLike Hidden" id="SearchAttributesHidden">
    <div class="Clear"></div>
    <label for="Number" id="LabelNumber">$Text{"Number"} $Text{"(e. g. 10*5155 or 105658*)"}:</label>
    <div class="Field">
        <input type="text" name="Number" value="$QData{"Number"}" class="W50pc" />
        <button type="button" class="Remove" value="Remove" title="$Text{"Remove this entry"}">$Text{"Remove"}</button>
    </div>

    <div class="Clear"></div>
    <label for="Name" id="LabelName">$Text{"Name"}:</label>
    <div class="Field">
        <input type="text" name="Name" value="$QData{"Name"}" class="W50pc" />
        <button type="button" class="Remove" value="Remove" title="$Text{"Remove this entry"}">$Text{"Remove"}</button>
    </div>

    <div class="Clear"></div>
    <label for="DeplStateIDs" id="LabelDeplStateIDs">$Text{"Deployment State"}:</label>
    <div class="Field">
        $Data{"CurDeplStateOptionStrg"}
        <button type="button" class="Remove" value="Remove" title="$Text{"Remove this entry"}">$Text{"Remove"}</button>
    </div>

    <div class="Clear"></div>
    <label for="InciStateIDs" id="LabelInciStateIDs">$Text{"Incident State"}:</label>
    <div class="Field">
        $Data{"CurInciStateOptionStrg"}
        <button type="button" class="Remove" value="Remove" title="$Text{"Remove this entry"}">$Text{"Remove"}</button>
    </div>

<!-- dtl:block:AttributeRow -->
    <div class="Clear"></div>
    <label for="$Text{"$Data{"Key"}"}" id="Label$Data{"Key"}" title="$Text{"$Data{"Description"}"}">$Text{"$Data{"Name"}"}:</label>
    <div class="Field">
        $Data{"InputString"}
        <button type="button" class="Remove" value="Remove" title="$Text{"Remove this entry"}">$Text{"Remove"}</button>
    </div>
<!-- dtl:block:AttributeRow -->
    <div class="Clear"></div>
    $Data{"AttributesOrigStrg"}
</fieldset>

<script type="text/javascript">//<![CDATA[
/*global ITSM: true */
    window.setTimeout(function (){
<!-- dtl:block:SearchAJAXShow -->
        ITSM.Agent.ConfigItem.Search.SearchAttributeAdd('$QData{"Attribute"}');
        ITSM.Agent.ConfigItem.Search.AdditionalAttributeSelectionRebuild();
<!-- dtl:block:SearchAJAXShow -->
    }, 0);
//]]></script>
<!-- dtl:block:AJAXContent -->
